================================================================================
                KLoROS SYSTEM ARCHITECTURE - QUICK SUMMARY
================================================================================

SYSTEM OVERVIEW
===============
KLoROS is an advanced autonomous AI voice assistant with evolutionary 
self-improvement, sophisticated memory systems, and multi-layered orchestration.

MAJOR SUBSYSTEMS (5)
====================

1. KLOROS CORE âœ… 100% Operational
   â””â”€ Voice pipeline with Vosk+Whisper hybrid STT
   â””â”€ Piper TTS with speaker enrollment
   â””â”€ Audio processing (VAD, calibration)
   â””â”€ Personality preservation system
   â””â”€ Location: /home/kloros/src/kloros_voice.py (183KB)

2. ASTRAEA FOUNDATION âœ… 100% Operational
   â””â”€ Autopoietic Spatial-Temporal Reasoning Architecture
   â””â”€ Foundational framework for all subsystems
   â””â”€ Mythological: Named after Virgo constellation goddess
   â””â”€ Philosophical basis for autonomous operation

3. D-REAM EVOLUTION âœ… 100% Operational
   â””â”€ Darwinian-RZero Evolution & Anti-collapse Module
   â””â”€ 14,125+ evaluations across 4 experiments
   â””â”€ 3 tools under active evolution (0% failure rate)
   â””â”€ Location: /home/kloros/src/dream/

4. PHASE TESTING ðŸŸ¡ Paused for Migration
   â””â”€ Phased Heuristic Adaptive Scheduling Engine
   â””â”€ Accelerated testing (3-7 AM daily)
   â””â”€ 8 domain specializations
   â””â”€ Location: /home/kloros/src/phase/

5. SPICA TEMPLATE ðŸŸ¡ Migration in Progress (60%)
   â””â”€ Self-Progressive Intelligent Cognitive Archetype
   â””â”€ Base template for all testable instances
   â””â”€ Status: Tests disabled pending SPICA type hierarchy

MEMORY SYSTEMS âœ… 100% Operational
=====================================
â”œâ”€ Episodic-Semantic Memory
â”‚  â””â”€ SQLite storage (~/.kloros/memory.db) with WAL mode
â”‚  â””â”€ Episode condensation with LLM summarization
â”‚  â””â”€ Smart context retrieval with multi-factor scoring
â”‚  â””â”€ Housekeeping & maintenance automation
â”‚
â”œâ”€ Idle Reflection System
â”‚  â””â”€ 15-minute self-analysis cycles
â”‚  â””â”€ Speech pipeline health monitoring
â”‚  â””â”€ Conversation pattern recognition
â”‚  â””â”€ Meta-cognitive insights
â”‚
â””â”€ Conversation Memory
   â””â”€ ChromaDB integration
   â””â”€ Last 6 turns + semantic similarity

ORCHESTRATION & CONTROL âœ… 100% Operational
==============================================
â”œâ”€ Orchestrator Coordinator
â”‚  â””â”€ State machine (8 states)
â”‚  â””â”€ Phase & Dream scheduling
â”‚  â””â”€ Result ingestion pipeline
â”‚
â”œâ”€ Lock Management
â”‚  â””â”€ fcntl-based exclusive locks
â”‚  â””â”€ PID tracking and stale detection
â”‚  â””â”€ TTL-based lock reaping
â”‚
â”œâ”€ GPU Maintenance
â”‚  â””â”€ Quiesce/Canary/Restore workflow
â”‚  â””â”€ Budget tracking with hard abort
â”‚  â””â”€ Maintenance window: 03:00-07:00 NY time
â”‚
â””â”€ Observer & Curiosity System
   â””â”€ Symptom detection & escalation
   â””â”€ Automatic question generation
   â””â”€ Capability gap analysis

REASONING & RAG âœ… 100% Operational
===================================
â”œâ”€ Hybrid RAG System
â”‚  â””â”€ BM25 keyword search
â”‚  â””â”€ BAAI/bge-small-en-v1.5 semantic embeddings
â”‚  â””â”€ RRF fusion & reranking
â”‚  â””â”€ 1,893 voice samples in knowledge base
â”‚
â”œâ”€ LLM Model Routing
â”‚  â””â”€ "live" â†’ qwen2.5:14b-instruct-q4_0
â”‚  â””â”€ "think" â†’ deepseek-r1:7b
â”‚  â””â”€ "code" â†’ qwen2.5-coder:32b
â”‚  â””â”€ "deep" â†’ qwen2.5:14b-instruct-q4_0
â”‚
â””â”€ Dual GPU Setup
   â””â”€ GPU 0 (RTX 3060 12GB): LIVE/CODE
   â””â”€ GPU 1 (GTX 1080 Ti 11GB): THINK/DEEP

TOOL SYNTHESIS âœ… 100% Operational
===================================
â”œâ”€ 50+ Introspection Tools
â”‚  â””â”€ System diagnostics
â”‚  â””â”€ Performance monitoring
â”‚  â””â”€ Audio analysis
â”‚  â””â”€ Memory introspection
â”‚
â”œâ”€ Tool Governance
â”‚  â””â”€ 50 tools/day quota (was 2)
â”‚  â””â”€ 200 tools/week quota (was 6)
â”‚  â””â”€ Shadow testing before promotion
â”‚
â””â”€ Tool Evolution
   â””â”€ 3 tools under active evolution
   â””â”€ Versioned directories with atomic symlink deployment
   â””â”€ LLM-guided mutation engine

D-REAM ACTIVE EXPERIMENTS
==========================
1. rag_opt_baseline         - 4,114 evals | Context recall, precision, latency
2. conv_quality_tune        - 5,409 evals | Helpfulness, faithfulness
3. audio_latency_trim       - 4,106 evals | Latency p95, underruns, CPU%
4. tool_evolution           - 496 evals  | Fail rate, latency, F1, QPS

KEY CONFIGURATION
=================
Audio:          KLR_INPUT_IDX=11 (CMTECK), KLR_INPUT_GAIN=4.0
STT:            KLR_STT_BACKEND=hybrid, ASR_CORRECTION_THRESHOLD=0.75
Memory:         KLR_ENABLE_MEMORY=1, KLR_AUTO_CONDENSE=1
GPU:            CUDA_VISIBLE_DEVICES=0, KLR_CANARY_TIMEOUT=30
Windows:        PHASE/GPU: "03:00-07:00 America/New_York"

CRITICAL PATHS
==============
Main voice:       /home/kloros/src/kloros_voice.py (183KB)
D-REAM runner:    /home/kloros/src/dream/complete_dream_system.py (800+ lines)
RAG engine:       /home/kloros/src/simple_rag.py
Orchestration:    /home/kloros/src/kloros/orchestration/coordinator.py
Introspection:    /home/kloros/src/introspection_tools.py (166KB)

KNOWN ISSUES
============
1. SPICA Migration - Tests disabled pending type hierarchy completion
2. Context Loss - max_ctx_chars=3000 too small (recommend 6000-8000)
3. File Ownership - Should be kloros:kloros (FIXED Oct 20)

COMPLETION STATUS
=================
âœ… KLoROS Voice Pipeline         100%
âœ… Memory Systems                100%
âœ… D-REAM Evolution               100%
âœ… Orchestration                  100%
âœ… RAG System                     100%
âœ… Tool Synthesis                 100%
âœ… Observer & Curiosity           100%
ðŸŸ¡ SPICA Migration                 60%
ðŸ“… Camera Integration             Planned
ðŸ“… Physical Embodiment            Planned

METRICS (October 2025)
======================
Evolution Evaluations:          14,125+
Tool Evolution Evals:               496
Tool Evolution Failure Rate:        0%
Telemetry Collected:           7.1 MB
Zero-Downtime Deployment:      âœ… Yes

DOCUMENTATION
==============
Comprehensive:  /home/kloros/KLOROS_SYSTEM_ANALYSIS_COMPREHENSIVE.md
Architecture:   /home/kloros/COMPONENT_ARCHITECTURE.md
Quick Ref:      /home/kloros/COMPONENT_QUICK_REFERENCE.txt
ASTRAEA:        /home/kloros/docs/ASTRAEA_SYSTEM_THESIS.md
System Org:     /home/kloros/docs/SYSTEM_ARCHITECTURE_OVERVIEW.md

VOICE PIPELINE FLOW
===================
Audio (48kHz, USB)
  â†“
VAD (Silero + RMS dBFS)
  â†“
STT Hybrid (Vosk + Whisper)
  â†“
Query Classification
  â†“
RAG Retrieval
  â†“
LLM Inference (mode-routed)
  â†“
TTS Synthesis (Piper)
  â†“
Audio Output

EVOLUTION PIPELINE
==================
D-REAM (24/7)
  â†“
Candidate Generation
  â†“
Multi-regime Evaluation
  â†“
Fitness & Novelty
  â†“
Tournament Selection
  â†“
Approval Gate (Safety)
  â†“
Atomic Deployment
  â†“
PHASE Testing (3-7 AM)
  â†“
Result â†’ Dashboard â†’ Promotion

WHAT'S COMPLETE & WORKING
==========================
âœ“ Voice-to-voice conversation pipeline
âœ“ Episodic memory with condensation
âœ“ Autonomous evolutionary optimization
âœ“ Tool synthesis and evolution
âœ“ GPU-accelerated inference with fallbacks
âœ“ Complete orchestration & scheduling
âœ“ Observer system with escalation
âœ“ RAG with hybrid retrieval
âœ“ Speaker identification & enrollment
âœ“ Comprehensive logging & monitoring
âœ“ Idle reflection system
âœ“ Safety gates & approval workflow

WHAT NEEDS ATTENTION
====================
âš  SPICA type hierarchy finalization
âš  Domain derivative implementations
âš  CI gate for SPICA compliance
âš  RAG context window increase (3000â†’8000 chars)
âš  D-REAM/PHASE test re-enablement

RECOMMENDED NEXT STEPS
======================
1. Complete SPICA type hierarchy
2. Migrate all domains to SPICA derivatives
3. Implement CI enforcement for SPICA
4. Re-enable D-REAM and PHASE tests
5. Increase RAG context window
6. Monitor tool evolution convergence
7. Track GPU isolation effectiveness

================================================================================
Analysis Date: November 3, 2025
Scope: Complete KLoROS system (72 src directories, 200+ Python files)
Thoroughness: Very Thorough
================================================================================
